=== Job 765 started at Fri Nov 14 23:42:28 UTC 2025 on gpu-workers-0 ===
=== Running: flwr run . cluster-gpu ===
Loading project configuration... 
Success
[92mINFO [0m:      Device: AMD Instinct MI300X VF
[92mINFO [0m:      W&B disabled (credentials not provided). Set WANDB_API_KEY, WANDB_ENTITY, and WANDB_PROJECT to enable.
Downloading: "https://download.pytorch.org/models/efficientnet_b0_rwightman-7f5810bc.pth" to /tmp/job-765/xdg-cache/torch/hub/checkpoints/efficientnet_b0_rwightman-7f5810bc.pth
  0%|          | 0.00/20.5M [00:00<?, ?B/s]100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 20.5M/20.5M [00:00<00:00, 230MB/s]
[92mINFO [0m:      Starting HackathonFedAvg strategy:
[92mINFO [0m:      	â”œâ”€â”€ Number of rounds: 100
[92mINFO [0m:      	â”œâ”€â”€ ArrayRecord (15.49 MB)
[92mINFO [0m:      	â”œâ”€â”€ ConfigRecord (train): {'lr': 0.05}
[92mINFO [0m:      	â”œâ”€â”€ ConfigRecord (evaluate): (empty!)
[92mINFO [0m:      	â”œâ”€â”€> Sampling:
[92mINFO [0m:      	â”‚	â”œâ”€â”€Fraction: train (1.00) | evaluate ( 1.00)
[92mINFO [0m:      	â”‚	â”œâ”€â”€Minimum nodes: train (2) | evaluate (2)
[92mINFO [0m:      	â”‚	â””â”€â”€Minimum available nodes: 2
[92mINFO [0m:      	â””â”€â”€> Keys in records:
[92mINFO [0m:      		â”œâ”€â”€ Weighted by: 'num-examples'
[92mINFO [0m:      		â”œâ”€â”€ ArrayRecord key: 'arrays'
[92mINFO [0m:      		â””â”€â”€ ConfigRecord key: 'config'
[92mINFO [0m:      
[92mINFO [0m:      
[92mINFO [0m:      [ROUND 1/100]
[92mINFO [0m:      configure_train: Sampled 3 nodes (out of 3)
[36m(ClientAppActor pid=2961805)[0m /usr/lib/python3.12/multiprocessing/popen_fork.py:66: DeprecationWarning: This process (pid=2961805) is multi-threaded, use of fork() may lead to deadlocks in the child.
[36m(ClientAppActor pid=2961805)[0m   self.pid = os.fork()
[36m(ClientAppActor pid=2961805)[0m /scratch/hackathon-venv/lib/python3.12/site-packages/torch/utils/data/_utils/pin_memory.py:57: DeprecationWarning: The argument 'device' of Tensor.pin_memory() is deprecated. Please do not pass this argument. (Triggered internally at /pytorch/aten/src/ATen/native/Memory.cpp:46.)
[36m(ClientAppActor pid=2961805)[0m   return data.pin_memory(device)
[36m(ClientAppActor pid=2961805)[0m /scratch/hackathon-venv/lib/python3.12/site-packages/torch/utils/data/_utils/pin_memory.py:57: DeprecationWarning: The argument 'device' of Tensor.is_pinned() is deprecated. Please do not pass this argument. (Triggered internally at /pytorch/aten/src/ATen/native/Memory.cpp:31.)
[36m(ClientAppActor pid=2961805)[0m   return data.pin_memory(device)
[92mINFO [0m:      aggregate_train: Received 3 results and 0 failures
[92mINFO [0m:      	â””â”€â”€> Aggregated MetricRecord: {'partition-id': 0.7453931785883467, 'train_loss': 1.000378146787361}
[92mINFO [0m:      configure_evaluate: Sampled 3 nodes (out of 3)
[92mINFO [0m:      METRICS BY HOSPITAL
[92mINFO [0m:        HospitalB (n=2860):
[92mINFO [0m:          auroc       : 0.5019
[92mINFO [0m:          eval_loss   : 14.6523
[92mINFO [0m:          sensitivity : 1.0000
[92mINFO [0m:          specificity : 0.0000
[92mINFO [0m:          precision   : 0.3787
[92mINFO [0m:          f1          : 0.5493
[92mINFO [0m:        HospitalC (n=2730):
[92mINFO [0m:          auroc       : 0.5057
[92mINFO [0m:          eval_loss   : 11.8261
[92mINFO [0m:          sensitivity : 1.0000
[92mINFO [0m:          specificity : 0.0000
[92mINFO [0m:          precision   : 0.5183
[92mINFO [0m:          f1          : 0.6828
[92mINFO [0m:        HospitalA (n=5490):
[92mINFO [0m:          auroc       : 0.5004
[92mINFO [0m:          eval_loss   : 12.9172
[92mINFO [0m:          sensitivity : 1.0000
[92mINFO [0m:          specificity : 0.0000
[92mINFO [0m:          precision   : 0.4709
[92mINFO [0m:          f1          : 0.6402
[92mINFO [0m:      AGGREGATED METRICS:
[92mINFO [0m:        auroc       : 0.5023
[92mINFO [0m:        sensitivity : 1.0000
[92mINFO [0m:        specificity : 0.0000
[92mINFO [0m:        precision   : 0.4588
[92mINFO [0m:        f1          : 0.6290
[92mINFO [0m:      âœ“ New best model! Round 1, AUROC: 0.5023
[92mINFO [0m:        Model saved to models/job765_e-archv10-oop_round1_auroc5022.pt
[92mINFO [0m:      	â””â”€â”€> Aggregated MetricRecord: {'auroc': 0.5022962330401217, 'sensitivity': 1.0, 'specificity': 0.0, 'precision': 0.4587545126353791, 'f1': 0.6289673946668316}
[92mINFO [0m:      
[92mINFO [0m:      [ROUND 2/100]
[92mINFO [0m:      configure_train: Sampled 3 nodes (out of 3)
[36m(ClientAppActor pid=2961805)[0m /usr/lib/python3.12/multiprocessing/popen_fork.py:66: DeprecationWarning: This process (pid=2961805) is multi-threaded, use of fork() may lead to deadlocks in the child.[32m [repeated 3x across cluster][0m
[36m(ClientAppActor pid=2961805)[0m   self.pid = os.fork()[32m [repeated 3x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m /scratch/hackathon-venv/lib/python3.12/site-packages/torch/utils/data/_utils/pin_memory.py:57: DeprecationWarning: The argument 'device' of Tensor.pin_memory() is deprecated. Please do not pass this argument. (Triggered internally at /pytorch/aten/src/ATen/native/Memory.cpp:46.)[32m [repeated 2x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m   return data.pin_memory(device)[32m [repeated 4x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m /scratch/hackathon-venv/lib/python3.12/site-packages/torch/utils/data/_utils/pin_memory.py:57: DeprecationWarning: The argument 'device' of Tensor.is_pinned() is deprecated. Please do not pass this argument. (Triggered internally at /pytorch/aten/src/ATen/native/Memory.cpp:31.)[32m [repeated 2x across cluster][0m
[92mINFO [0m:      aggregate_train: Received 3 results and 0 failures
[92mINFO [0m:      	â””â”€â”€> Aggregated MetricRecord: {'partition-id': 0.7453931785883467, 'train_loss': 0.3653157962766038}
[92mINFO [0m:      configure_evaluate: Sampled 3 nodes (out of 3)
[92mINFO [0m:      METRICS BY HOSPITAL
[92mINFO [0m:        HospitalC (n=2730):
[92mINFO [0m:          auroc       : 0.5000
[92mINFO [0m:          eval_loss   : 365.4210
[92mINFO [0m:          sensitivity : 1.0000
[92mINFO [0m:          specificity : 0.0000
[92mINFO [0m:          precision   : 0.5183
[92mINFO [0m:          f1          : 0.6828
[92mINFO [0m:        HospitalB (n=2860):
[92mINFO [0m:          auroc       : 0.5000
[92mINFO [0m:          eval_loss   : 469.7844
[92mINFO [0m:          sensitivity : 1.0000
[92mINFO [0m:          specificity : 0.0000
[92mINFO [0m:          precision   : 0.3787
[92mINFO [0m:          f1          : 0.5493
[92mINFO [0m:        HospitalA (n=5490):
[92mINFO [0m:          auroc       : 0.5000
[92mINFO [0m:          eval_loss   : 401.6290
[92mINFO [0m:          sensitivity : 1.0000
[92mINFO [0m:          specificity : 0.0000
[92mINFO [0m:          precision   : 0.4709
[92mINFO [0m:          f1          : 0.6402
[92mINFO [0m:      AGGREGATED METRICS:
[92mINFO [0m:        auroc       : 0.5000
[92mINFO [0m:        sensitivity : 1.0000
[92mINFO [0m:        specificity : 0.0000
[92mINFO [0m:        precision   : 0.4588
[92mINFO [0m:        f1          : 0.6290
[92mINFO [0m:        Model not saved (AUROC 0.5000 â‰¤ best 0.5023)
[92mINFO [0m:      	â””â”€â”€> Aggregated MetricRecord: {'auroc': 0.5, 'sensitivity': 1.0, 'specificity': 0.0, 'precision': 0.4587545126353791, 'f1': 0.6289673946668316}
[92mINFO [0m:      
[92mINFO [0m:      [ROUND 3/100]
[92mINFO [0m:      configure_train: Sampled 3 nodes (out of 3)
[36m(ClientAppActor pid=2961805)[0m /usr/lib/python3.12/multiprocessing/popen_fork.py:66: DeprecationWarning: This process (pid=2961805) is multi-threaded, use of fork() may lead to deadlocks in the child.[32m [repeated 3x across cluster][0m
[36m(ClientAppActor pid=2961805)[0m   self.pid = os.fork()[32m [repeated 3x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m /scratch/hackathon-venv/lib/python3.12/site-packages/torch/utils/data/_utils/pin_memory.py:57: DeprecationWarning: The argument 'device' of Tensor.pin_memory() is deprecated. Please do not pass this argument. (Triggered internally at /pytorch/aten/src/ATen/native/Memory.cpp:46.)[32m [repeated 3x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m   return data.pin_memory(device)[32m [repeated 6x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m /scratch/hackathon-venv/lib/python3.12/site-packages/torch/utils/data/_utils/pin_memory.py:57: DeprecationWarning: The argument 'device' of Tensor.is_pinned() is deprecated. Please do not pass this argument. (Triggered internally at /pytorch/aten/src/ATen/native/Memory.cpp:31.)[32m [repeated 3x across cluster][0m
[92mINFO [0m:      aggregate_train: Received 3 results and 0 failures
[92mINFO [0m:      	â””â”€â”€> Aggregated MetricRecord: {'partition-id': 0.7453931785883467, 'train_loss': 0.36109904513388175}
[92mINFO [0m:      configure_evaluate: Sampled 3 nodes (out of 3)
[91mERROR [0m:     ServerApp thread raised an exception: Input contains NaN.
[91mERROR [0m:     Traceback (most recent call last):
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/simulation/run_simulation.py", line 284, in server_th_with_start_checks
    updated_context = _run(
                      ^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/server/run_serverapp.py", line 62, in run
    server_app(grid=grid, context=context)
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/server/server_app.py", line 176, in __call__
    self._main(grid, context)
  File "/scratch/team04/765/repo/cold_start_hackathon/server_app.py", line 67, in main
    result = strategy.start(
             ^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/serverapp/strategy/strategy.py", line 254, in start
    agg_evaluate_metrics = self.aggregate_evaluate(
                           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/team04/765/repo/cold_start_hackathon/server_app.py", line 95, in aggregate_evaluate
    agg_metrics = compute_aggregated_metrics(replies)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/team04/765/repo/cold_start_hackathon/util.py", line 42, in compute_aggregated_metrics
    auroc = roc_auc_score(np.array(all_labels), np.array(all_probs))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/utils/_param_validation.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/metrics/_ranking.py", line 665, in roc_auc_score
    y_score = check_array(y_score, ensure_2d=False)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/utils/validation.py", line 1105, in check_array
    _assert_all_finite(
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/utils/validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/utils/validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.

Exception in thread Thread-1 (server_th_with_start_checks):
Traceback (most recent call last):
  File "/usr/lib/python3.12/threading.py", line 1073, in _bootstrap_inner
    self.run()
  File "/usr/lib/python3.12/threading.py", line 1010, in run
    self._target(*self._args, **self._kwargs)
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/simulation/run_simulation.py", line 284, in server_th_with_start_checks
    updated_context = _run(
                      ^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/server/run_serverapp.py", line 62, in run
    server_app(grid=grid, context=context)
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/server/server_app.py", line 176, in __call__
    self._main(grid, context)
  File "/scratch/team04/765/repo/cold_start_hackathon/server_app.py", line 67, in main
    result = strategy.start(
             ^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/serverapp/strategy/strategy.py", line 254, in start
    agg_evaluate_metrics = self.aggregate_evaluate(
                           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/team04/765/repo/cold_start_hackathon/server_app.py", line 95, in aggregate_evaluate
    agg_metrics = compute_aggregated_metrics(replies)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/team04/765/repo/cold_start_hackathon/util.py", line 42, in compute_aggregated_metrics
    auroc = roc_auc_score(np.array(all_labels), np.array(all_probs))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/utils/_param_validation.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/metrics/_ranking.py", line 665, in roc_auc_score
    y_score = check_array(y_score, ensure_2d=False)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/utils/validation.py", line 1105, in check_array
    _assert_all_finite(
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/utils/validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/sklearn/utils/validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
[36m(ClientAppActor pid=2961803)[0m /usr/lib/python3.12/multiprocessing/popen_fork.py:66: DeprecationWarning: This process (pid=2961803) is multi-threaded, use of fork() may lead to deadlocks in the child.[32m [repeated 2x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m   self.pid = os.fork()[32m [repeated 2x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m /scratch/hackathon-venv/lib/python3.12/site-packages/torch/utils/data/_utils/pin_memory.py:57: DeprecationWarning: The argument 'device' of Tensor.pin_memory() is deprecated. Please do not pass this argument. (Triggered internally at /pytorch/aten/src/ATen/native/Memory.cpp:46.)[32m [repeated 3x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m   return data.pin_memory(device)[32m [repeated 6x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m /scratch/hackathon-venv/lib/python3.12/site-packages/torch/utils/data/_utils/pin_memory.py:57: DeprecationWarning: The argument 'device' of Tensor.is_pinned() is deprecated. Please do not pass this argument. (Triggered internally at /pytorch/aten/src/ATen/native/Memory.cpp:31.)[32m [repeated 3x across cluster][0m
[36m(ClientAppActor pid=2961805)[0m Training on device: cuda:0
[36m(ClientAppActor pid=2961805)[0m Loaded /home/team04/xray-data/xray_fl_datasets_preprocessed_128/HospitalB/train
[36m(ClientAppActor pid=2961803)[0m Training on device: cuda:0[32m [repeated 2x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)[0m
[36m(ClientAppActor pid=2961805)[0m Loaded /home/team04/xray-data/xray_fl_datasets_preprocessed_128/HospitalB/eval[32m [repeated 3x across cluster][0m
[36m(ClientAppActor pid=2961805)[0m Training on device: cuda:0
[36m(ClientAppActor pid=2961805)[0m Loaded /home/team04/xray-data/xray_fl_datasets_preprocessed_128/HospitalC/train[32m [repeated 3x across cluster][0m
[36m(ClientAppActor pid=2961804)[0m Training on device: cuda:0
[36m(ClientAppActor pid=2961805)[0m Loaded /home/team04/xray-data/xray_fl_datasets_preprocessed_128/HospitalC/eval[32m [repeated 2x across cluster][0m
[36m(ClientAppActor pid=2961803)[0m Training on device: cuda:0
[36m(ClientAppActor pid=2961805)[0m Training on device: cuda:0
[36m(ClientAppActor pid=2961803)[0m Loaded /home/team04/xray-data/xray_fl_datasets_preprocessed_128/HospitalB/eval
[36m(ClientAppActor pid=2961803)[0m Training on device: cuda:0[32m [repeated 2x across cluster][0m
Traceback (most recent call last):
  File "/scratch/hackathon-venv/bin/flower-simulation", line 8, in <module>
    sys.exit(run_simulation_from_cli())
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/simulation/run_simulation.py", line 156, in run_simulation_from_cli
    _ = _run_simulation(
        ^^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/simulation/run_simulation.py", line 523, in _run_simulation
    updated_context = _main_loop(*args)
                      ^^^^^^^^^^^^^^^^^
  File "/scratch/hackathon-venv/lib/python3.12/site-packages/flwr/simulation/run_simulation.py", line 421, in _main_loop
    raise RuntimeError("Exception in ServerApp thread")
RuntimeError: Exception in ServerApp thread
Command '['flower-simulation', '--app', '.', '--num-supernodes', '3', '--backend-config', '{"client-resources": {"num-cpus": 2, "num-gpus": 0.33}}']' returned non-zero exit status 1.
=== Copying best model ===
  job765_e-archv10-oop_round1_auroc5022.pt
=== Job 765 finished with exit code 0 ===
